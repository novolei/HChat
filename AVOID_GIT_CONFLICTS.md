# ğŸ›¡ï¸ å¦‚ä½•é¿å… VPS Git å†²çª

## ğŸ“‹ é—®é¢˜å›é¡¾

ä¹‹å‰é‡åˆ°çš„é—®é¢˜ï¼š
```
error: Your local changes to the following files would be overwritten by merge:
    chat-gateway/server.js
Please commit your changes or stash them before you merge.
```

**åŸå› ï¼š** VPS ä¸Šæœ‰æœ¬åœ°ä¿®æ”¹æˆ–æäº¤ï¼Œä¸è¿œç¨‹ä»£ç å†²çªã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆå·²å®æ–½ï¼‰

### 1ï¸âƒ£ æ”¹è¿›çš„éƒ¨ç½²è„šæœ¬

`deploy.sh` ç°åœ¨ä¼š**è‡ªåŠ¨å¤„ç†**è¿™äº›é—®é¢˜ï¼š

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰
cd HCChatBackEnd
./deploy.sh chat-gateway
```

**è‡ªåŠ¨å¤„ç†ï¼š**
- âœ… æ£€æµ‹ VPS æœ¬åœ°ä¿®æ”¹
- âœ… è‡ªåŠ¨ stash ä¿å­˜
- âœ… å¼ºåˆ¶åŒæ­¥åˆ°è¿œç¨‹æœ€æ–°ä»£ç 
- âœ… é‡å¯æœåŠ¡

---

### 2ï¸âƒ£ ä¸€æ¬¡æ€§é…ç½®ï¼ˆå¯é€‰ï¼‰

é…ç½® VPS Git ç¯å¢ƒï¼Œé¿å…å°†æ¥çš„é—®é¢˜ï¼š

```bash
cd HCChatBackEnd
./setup-vps-git.sh
```

è¿™ä¼šåœ¨ VPS ä¸Šï¼š
- é…ç½® Git pull ç­–ç•¥ä¸º fast-forward only
- ä¿å­˜ç°æœ‰æœ¬åœ°ä¿®æ”¹åˆ° stash
- åŒæ­¥åˆ°è¿œç¨‹æœ€æ–°ç‰ˆæœ¬

---

## ğŸ¯ æœ€ä½³å®è·µï¼ˆå¿…è¯»ï¼‰

### é»„é‡‘æ³•åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ°¸è¿œä¸è¦åœ¨ VPS ä¸Šç›´æ¥ä¿®æ”¹ä»£ç ï¼       â”‚
â”‚                                         â”‚
â”‚  å¼€å‘ â†’ æäº¤ â†’ æ¨é€ â†’ éƒ¨ç½²             â”‚
â”‚  (Mac)  (Git) (GitHub) (VPS)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ­£ç¡®çš„å¼€å‘æµç¨‹

```bash
# 1. åœ¨ Mac ä¸Šç¼–è¾‘ä»£ç 
cd /Users/ryanliu/DDCS/HChat/HCChatBackEnd
vim chat-gateway/server.js

# 2. æœ¬åœ°æäº¤
git add .
git commit -m "ä¿®æ”¹: xxx"
git push origin main

# 3. ä¸€é”®éƒ¨ç½²åˆ° VPS
./deploy.sh chat-gateway
```

---

## âŒ é”™è¯¯åšæ³•ï¼ˆé¿å…ï¼‰

**ä¸è¦è¿™æ ·åšï¼š**

```bash
# âŒ SSH åˆ° VPS
ssh root@mx.go-lv.com

# âŒ ç›´æ¥ä¿®æ”¹æ–‡ä»¶
vim /root/hc-stack/chat-gateway/server.js

# âŒ åœ¨ VPS ä¸Šæäº¤
git add .
git commit -m "xxx"
```

**ä¸ºä»€ä¹ˆä¸è¡Œï¼š**
- ä¼šå¯¼è‡´ VPS å’Œè¿œç¨‹ä»£ç åˆ†æ­§
- ä¸‹æ¬¡éƒ¨ç½²æ—¶ä¼šå†²çª
- æ— æ³•ç‰ˆæœ¬æ§åˆ¶å’Œå›¢é˜Ÿåä½œ

---

## ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†

### å¦‚æœä¸å°å¿ƒåœ¨ VPS ä¸Šæ”¹äº†ä»£ç 

**æ–¹æ³• 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
# åœ¨æœ¬åœ° Mac ä¸Š
./deploy.sh chat-gateway
# è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†
```

**æ–¹æ³• 2: æ‰‹åŠ¨å¤„ç†**
```bash
# åœ¨ VPS ä¸Š
cd /root/hc-stack
git stash save "ä¸´æ—¶å¤‡ä»½"
git fetch origin
git reset --hard origin/main
cd infra
docker compose restart chat-gateway
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†æœ€ä½³å®è·µï¼š** `HCChatBackEnd/DEPLOYMENT_BEST_PRACTICES.md`
- **éƒ¨ç½²è„šæœ¬ä½¿ç”¨ï¼š** `HCChatBackEnd/README.md`
- **æ•…éšœæ’é™¤ï¼š** `HCChatBackEnd/TROUBLESHOOTING.md`

---

## âœ¨ æ€»ç»“

### è®°ä½ä¸‰ç‚¹

1. **å¼€å‘åœ¨æœ¬åœ°** - Mac ä¸Šç¼–è¾‘ã€æµ‹è¯•ã€æäº¤
2. **ä½¿ç”¨è„šæœ¬éƒ¨ç½²** - `./deploy.sh service-name`
3. **VPS åªè¿è¡Œ** - ä¸ä¿®æ”¹ã€ä¸æäº¤

### ä¸€å¥è¯

**"VPS æ˜¯è¿è¡Œç¯å¢ƒï¼Œä¸æ˜¯å¼€å‘ç¯å¢ƒ"** ğŸ¯

---

**éµå¾ªè¿™äº›å®è·µï¼Œå°±ä¸ä¼šå†é‡åˆ° Git å†²çªé—®é¢˜äº†ï¼** âœ¨

